%-*-coding: utf-8-*-

\chapter{Постановка задачи}
Язык \verb|KPHP| уже существует более пяти лет за это время образовалась достаточно большая кодовая база.
Сейчас в проекте более 60000 строк кода и почти 30000 строк в файлах содержащих тесты к проекты, по результатам запуска \verb|sloccount|\cite{sloccount}. Так как мы решили, что должны добавить поддержку функций высших порядков и анонимных функций важно было придумать лаконичное решение, вписывающиеся в текущую архитектуру.

В данной работе нам предстоит придумать, как организовать логику передачи анонимных функций и сохранения их в переменные. \verb|KPHP| - типизированный язык для данной задачи необходимо придумать соответствующую логику, вписывающуюся в имеющуюся архитектуру. Продумать как будут анонимные функции транслироваться в \verb|C++| код и что они будут представлять из себя. Каждый вызов анонимной функции транслировать в соответствующий код вызывающий нужную функцию, который корректно обрабатывает все входные данные и захватит нужное окружение.

Для передачи лямбд, методов и других функций в качестве аргументов можно использовать мономорфизацию, которая отлично вписывается в текущую архитектуру, но вот для записи в одно и тоже поле класса разных инстансов лямбда функций будет сложнее. Для этого необходимо разработать интерфейсы и соответствующий синтаксис для возможности задания функционального типа в коде и сохранение в него различных объектов, которые можно вызывать без потери производительности, которые в свою очередь будут автоматически наследоваться от соответствующего интерфейса. 

Нужно продумать как поддержать ссылочную семантику для интерфейсов. Добавить возможность задания классов, которые реализуют тот или иной интерфейс, продумать дизайн для создания наследования интерфейсов друг от друга. Сделать статический анализ на корректность унаследовавшихся классов. Поддержать возможность проверки на подтип \verb|instanceof| и сделать возможным понижающие приведение. Также нужно научиться поддерживать состояние для различных переменных, экземпляром какого из подтипа она может являться, чтобы автоматически производить понижающее приведение где это необходимо - это должно значительно упростить использование интерфейсов разработчиками.

Для уменьшения ошибок при написании анонимных функций с захватом внешних переменных разработать синтаксис, который будет ограничивать переменные на запись, добавляя им семантику константных переменных. Зачастую разработчики не ожидают поведения, предоставляемого языков \verb|PHP|, когда они пытаются изменить захваченные переменные, а если им нужно будет поменять, то нужно будет всего лишь скопировать в другую переменную, чтобы наверняка понимать, что захваченные аргументы не меняют своих значений.

Нужно продумать новый синтаксис для типизации встроенных в язык функций таких как \verb|array_map|, \verb|array_reduce| и другие. Все они принимают анонимную функцию в качестве аргумента, типы аргументов которой зависят от передаваемых параметров встроенной функции. Разработав систему задания типов для анонимных функций, нужно понять как внедрить это в язык \verb|KPHP|, для корректного сопоставления с типами во всех местах использования.

\section{Термины и понятия}
\textbf{Трансляция} -- перевод из одного языка программирования в другой с целью ускорения и уменьшения потребления памяти.

\textbf{Лямбда функция}-- функция, которая не имеет уникального идентификатора и обычно создаются в месте использования.

\textbf{Анонимная функция} -- лямбда функция.

\textbf{Функция высших порядков} -- либо принимает другую функцию как аргумент, либо возвращает созданную в теле функцию.

\textbf{Захваченная переменная} -- переменная которая была сохранена и продолжает существовать внутри лямбда функции.

\textbf{Ссылочная семантика} -- когда любое присвоение объектов в другие переменные копирует только ссылку на него.

\textbf{Понижающее приведение} -- преобразование переменной, ссылающийся на базовый класс, к одному из производных классов.

\textbf{Встроенные функции} -- функции которые написаны на \verb|C++|, тело которых скрыто для разработчиков на языке \verb|KPHP|, однако они имеют возможность вызывать их.

\textbf{Типизация} -- процесс сопоставления различных переменных с соответствующими типами, а также возвращаемых значений функций.

\textbf{Проверка на подтип} -- процесс в результате которого получается булевское значение истинность которого показывает является ли соответствующая переменная данным подтипом.

\textbf{Инстанс} -- один из экземпляров конкретного класса.

\textbf{Мономорфизация} -- техника, которая заключается в порождении мономорфного экземпляра для каждого случая использования полиморфной функции или типа.

\textbf{Примитивный тип} -- такой тип, встроенный в язык \verb|KPHP|, который может представлять из себя один из типов: целых чисел, вещественных чисел, значений из булева множества, строк, а также массивов.

\textbf{Тип-сумма} -- тип построенный как дизъюнктное объедение исходных типов.

\section{Актуальность}
Здесь рассмотрим HHVM и PHP7

\section{Уточненные требования к работе}
Рюзимируем коротко требования.

\chapterconclusion
Из этой главы мы поняли, что задача достаточно трудоемкая и требует глубокого анализа поставленной задачи.
Рассмотрим недостатки существующих решений в следующих главах.



